__require=function t(e,o,n){function i(a,c){if(!o[a]){if(!e[a]){var s="function"==typeof __require&&__require;if(!c&&s)return s(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=o[a]={exports:{}};e[a][0].call(l.exports,function(t){var o=e[a][1][t];return i(o||t)},l,l.exports,t,e,o,n)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({blockSelector:[function(t,e,o){"use strict";cc._RF.push(e,"a799eWfBwlPwbtJCJsEKahV","blockSelector"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,r=(n.property,t("../block/text")),a=t("../global"),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var o;return __extends(e,t),o=e,e.prototype.updateContent=function(){var t=this.ccLabel.node.getContentSize(),e=Math.max(t.width/2+2*o.PADDING,o.MIN_WIDTH),n=t.height/2+2*o.PADDING;this.node.setContentSize(e,n),this.size=cc.size(e,n)},e.prototype.onClick=function(){var t=a.Blocks.fromOnt(this.data),e=["ad",t.bid];a.UI.focus?(a.UI.fillFocus(t),"value"in t?(e.push(t.parent.parent.bid),e.push(t.parent.pid)):(e.push(t.parent.bid),e.push(t.target))):t.parent=a.UI.layer,a.Records.push(e),t.show()},e.prototype.reset=function(){this.color="proto"in this.data?a.Colors[this.data.type][this.data.proto]:a.Colors[this.data.type],this.node.color=this.color,this.isResetCalled=!0,this.updateBlock(null),this.node.opacity=255},e.PADDING=14,e.MIN_WIDTH=70,e=o=__decorate([i],e)}(r.default);o.default=c,cc._RF.pop()},{"../block/text":"text","../global":"global"}],block:[function(t,e,o){"use strict";cc._RF.push(e,"54bc4hNcoFLPICYNY2ZOyyR","block"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,r=(n.property,n.disallowMultiple),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=cc.Color.BLACK,e._parent=null,e.size=cc.size(0,0),e.isResetCalled=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"position",{get:function(){return this.node.position},set:function(t){this.node.position=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(t){this.parent!=t&&(this._parent=t,this.node.parent=t?t.node:null,this.node.zIndex=0)},enumerable:!0,configurable:!0}),e.prototype.updateContent=function(){},e.prototype.updateDisplay=function(){},e.prototype.updateBlock=function(t){if(this.isResetCalled){var e=!1,o=this.bchilds;if(t)for(var n in o)if(this[n]==t){if(!o[n])return void this.cascadeUpdate();e=!0;break}e||this.updateContent(),this.updateDisplay();for(var n in o)this[n+"Update"]();t&&this.cascadeUpdate()}},e.prototype.cascadeUpdate=function(){this.parent&&this.parent.updateBlock(this)},e.prototype.init=function(){this.isResetCalled=!1,this.node.opacity=0},e.prototype.reset=function(){this.node.opacity=255},e.prototype.show=function(){this.scheduleOnce(function(){this.reset(),this.cascadeUpdate()})},e.ccPrefab=null,e=__decorate([i,r],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],collider:[function(t,e,o){"use strict";cc._RF.push(e,"3319du6YRZDgZ+uxCYY8MC+","collider"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,r=n.property,a=t("../block/block"),c=t("../global"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.child="",e.block=null,e}return __extends(e,t),e.prototype.onCollisionEnter=function(t,e){e.child&&t.block!=e.block.parent&&t.block!=e.block&&e.block[e.child+"Check"](t.block.data)&&(c.UI.focus=e.block,"target"in t.block&&(t.block.target=e.child))},e.prototype.onCollisionExit=function(t,e){e.child&&c.UI.focus==e.block&&("target"in t.block?t.block.target==e.child&&(t.block.target=null,c.UI.focus=null):c.UI.focus=null)},__decorate([r(cc.String)],e.prototype,"child",void 0),__decorate([r(a.default)],e.prototype,"block",void 0),e=__decorate([i],e)}(cc.BoxCollider);o.default=s,cc._RF.pop()},{"../block/block":"block","../global":"global"}],expression:[function(t,e,o){"use strict";cc._RF.push(e,"e0f39U5ktZEwq/ES1BAfz/R","expression"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./block"),i=t("../util/collider"),r=t("../global"),a=cc._decorator,c=a.ccclass,s=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.context=null,e.collider=null,e._params=[],e._texts=[],e}var o;return __extends(e,t),o=e,Object.defineProperty(e.prototype,"params",{get:function(){return this._params},set:function(t){this._params&&this._params.forEach(function(t){t.parent=null},this),this._params=t,t.forEach(function(t){t.parent=this},this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texts",{get:function(){return this._texts},set:function(t){this._texts&&this._texts.forEach(function(t){t&&(t.parent=null)},this),this._texts=t,t.forEach(function(t){t&&(t.parent=this)},this)},enumerable:!0,configurable:!0}),e.prototype.render=function(){this.context.fill(),this.context.stroke()},e.prototype.updateDisplay=function(){var t=this.node.getContentSize();this.context.clear(),this.context.roundRect(0,-t.height,t.width,t.height,o.PADDING),this.render()},e.prototype.updateContent=function(){var t=this,e=[];this.texts[0]&&e.push(this.texts[0]),this.params.forEach(function(o,n){e.push(o),t.texts[n+1]&&e.push(t.texts[n+1])});var n=cc.size(0,0);e.forEach(function(t){n.width+=t.size.width,n.height=Math.max(t.size.height,n.height)}),n.width+=o.SPACING*(e.length-1);var i=cc.size(n);i.width=Math.max(i.width+o.PADDING+2,o.MINWIDTH),i.height=Math.max(i.height+o.PADDING+2,o.MINHEIGHT);var r=(i.width-n.width)/2;e.forEach(function(t){t.position=cc.v2(r,-(i.height-t.size.height)/2),r+=t.size.width+o.SPACING}),this.node.setContentSize(i),this.size=i},e.prototype.onDragStart=function(t){this.parent=r.UI.layer,this.node.opacity=125,this.collider.offset=this.node.convertToNodeSpaceAR(t.position),r.UI.focus=null,r.UI.showBlockSelector(!1),this.collider.enabled=!0},e.prototype.onDragEnd=function(t){this.node.opacity=255,r.UI.focus&&"argument"in r.UI.focus&&(r.UI.focus.argument=this),r.UI.showBlockSelector(!0),this.collider.enabled=!1},e.prototype.onClick=function(t){if(r.UI.focus){if(!("argument"in r.UI.focus)||r.UI.focus.node.isChildOf(this.node))return;r.UI.fillFocus(this)}else r.UI.focus=this},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(t){if(this.parent!=t){var e=null;this._parent&&"argument"in this.parent&&(this.parent.argument=null,e=this._parent.node.convertToWorldSpaceAR(this.position)),this._parent=t,this.node.parent=t?t.node:null,this.node.zIndex=0,"argument"in t||(this.position=e?t.node.convertToNodeSpaceAR(e):cc.v2())}},enumerable:!0,configurable:!0}),e.prototype.serialize=function(t){var e={bid:this.bid,name:this.data.name};if("params"in this.data){var o=[];this.params.forEach(function(e){o.push(e.argument?t?e.argument.serialize(!0):e.argument.bid:null)}),e.args=o}else"input"in this.data&&(e.proto=this.data.proto,e.input=this.data.input);return e},Object.defineProperty(e.prototype,"value",{get:function(){if("params"in this.data){var t=[];if(this.params.forEach(function(e){t.push(e.value)}),r.Runtime.errorOccurred)return;return r.Runtime.Exp[this.data.name](t)}return"input"in this.data?this.data.proto==r.ProtoType.Number?parseInt(this.data.input):this.data.input.slice(1,-1):r.Runtime.Var[this.data.name]},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.params.forEach(function(t){t.reset()}),this.texts.forEach(function(t){t&&t.reset()}),this.context.fillColor=r.Colors.Basic,this.color=r.Colors.Var[this.data.proto],this.context.strokeColor=this.color,this.isResetCalled=!0,this.updateBlock(null),this.node.opacity=255},e.MINWIDTH=60,e.MINHEIGHT=46,e.PADDING=10,e.SPACING=10,__decorate([s(cc.Graphics)],e.prototype,"context",void 0),__decorate([s(i.default)],e.prototype,"collider",void 0),e=o=__decorate([c],e)}(n.default);o.default=l,cc._RF.pop()},{"../global":"global","../util/collider":"collider","./block":"block"}],global:[function(t,e,o){"use strict";var n,i,r,a,c,s;cc._RF.push(e,"3b024zdM1NKr6x2KpPfimUp","global"),Object.defineProperty(o,"__esModule",{value:!0}),function(t){t.Boolean="Boolean",t.Number="Number",t.String="String"}(c=o.ProtoType||(o.ProtoType={})),function(t){t.Var="Var",t.Exp="Exp",t.Sta="Sta",t.Para="Para",t.LoopSta="LoopSta",t.IfSta="IfSta",t.FinalSta="FinalSta",t.StartSta="StartSta",t.Temp="Temp"}(s=o.TypeType||(o.TypeType={}));var l=function(){function t(t){this.name=t}return t.prototype.toJSON=function(){return this.name},t}();o.iOnt=l;var u=function(t){function e(e,o){var n=t.call(this,"Temp")||this;return n.type=s.Temp,n.input=e,n.proto=o,n}return __extends(e,t),e.prototype.toJSON=function(){return this.input},e}(l);o.Temp=u;var h=function(t){function e(e,o,n){void 0===n&&(n=!1);var i=t.call(this,e)||this;return i.type=s.Var,i.proto=o,i.readonly=n,i}return __extends(e,t),e}(l);o.Var=h;var p=function(t){function e(e,o,n){void 0===n&&(n=!1);var i=t.call(this,e)||this;return i.type=s.Para,i.proto=o,i.edit=n,i}return __extends(e,t),e}(l);o.Para=p;var d=function(t){function e(e,o,n,i){void 0===i&&(i=[]);var r=t.call(this,e)||this;return r.type=s.Exp,r.proto=o,r.params=n,r.texts=i,r}return __extends(e,t),e}(l);o.Exp=d;var f=function(t){function e(e,o,n){void 0===n&&(n=[]);var i=t.call(this,e)||this;return i.type=s.Sta,i.params=o,i.texts=n,i}return __extends(e,t),e}(l);o.Sta=f;var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=s.LoopSta,e}return __extends(e,t),e}(f);o.LoopSta=m;var b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=s.IfSta,e}return __extends(e,t),e}(m);o.IfSta=b;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=s.FinalSta,e}return __extends(e,t),e}(f);o.FinalSta=_;var y=function(t){function e(){var e=t.call(this,"start",[])||this;return e.type=s.StartSta,e}return __extends(e,t),e}(f);o.StartSta=y;var g=((n={}).TRUE=new h("TRUE",c.Boolean,!0),n.FALSE=new h("FALSE",c.Boolean,!0),n["+"]=new d("+",c.Number,[new p("A",c.Number),new p("B",c.Number)],[null,"+"]),n["-"]=new d("-",c.Number,[new p("A",c.Number),new p("B",c.Number)],[null,"-"]),n["\xd7"]=new d("\xd7",c.Number,[new p("A",c.Number),new p("B",c.Number)],[null,"\xd7"]),n["\xf7"]=new d("\xf7",c.Number,[new p("A",c.Number),new p("B",c.Number)],[null,"\xf7"]),n["%"]=new d("%",c.Number,[new p("A",c.Number),new p("B",c.Number)],[null,"%"]),n.pow=new d("pow",c.Number,[new p("A",c.Number),new p("B",c.Number)],[null,"^"]),n.abs=new d("abs",c.Number,[new p("X",c.Number)],["|","|"]),n.and=new d("and",c.Boolean,[new p("A",c.Boolean),new p("B",c.Boolean)],[null,"&"]),n.or=new d("or",c.Boolean,[new p("A",c.Boolean),new p("B",c.Boolean)],[null,"|"]),n.not=new d("not",c.Boolean,[new p("X",c.Boolean)],["!"]),n[">"]=new d(">",c.Boolean,[new p("A",c.Number),new p("B",c.Number)],[null,">"]),n[">="]=new d(">=",c.Boolean,[new p("A",c.Number),new p("B",c.Number)],[null,">="]),n["<"]=new d("<",c.Boolean,[new p("A",c.Number),new p("B",c.Number)],[null,"<"]),n["<="]=new d("<=",c.Boolean,[new p("A",c.Number),new p("B",c.Number)],[null,"<="]),n.let=new f("let",[new p("A",c.Boolean,!0),new p("X",c.Boolean)],["LET","BE"]),n.print=new f("print",[new p("string",c.String)],["print"]),n.if=new b("if",[new p("condition",c.Boolean)],["IF"]),n["else if"]=new b("else if",[new p("condition",c.Boolean)],["ELSE IF"]),n.else=new b("else",[],["ELSE"]),n.while=new m("while",[new p("condition",c.Boolean)],["WHILE"]),n.end=new _("end",[],["END"]),n.continue=new _("continue",[],["CONTINUE"]),n.break=new _("break",[],["BREAK"]),n),I={};o.Records={push:function(t){for(var e=parseInt(cc.sys.localStorage.getItem("records")),n=parseInt(cc.sys.localStorage.getItem("current"));n!=e;)cc.sys.localStorage.removeItem("r"+e),e--;n++,cc.sys.localStorage.setItem("r"+n,JSON.stringify(t)),cc.sys.localStorage.setItem("records",n),cc.sys.localStorage.setItem("current",n),o.UI.updateUnRedo()},undo:function(){var t=parseInt(cc.sys.localStorage.getItem("current"));if(0!=t){var e=JSON.parse(cc.sys.localStorage.getItem("r"+t));switch(e[0]){case"ad":var n=e[1]+0;e[1]=JSON.stringify(I[n].serialize(!0)),o.Blocks.remove(I[n]);break;case"cp":o.Blocks.remove(I[e[2]]);break;case"dl":var i=o.Blocks.fromJSON(JSON.parse(e[1]));e[2]?"value"in i?I[e[2]].params[e[3]].argument=i:I[e[2]][e[3]]=i:i.parent=o.UI.layer,e[1]=i.bid,i.show()}cc.sys.localStorage.setItem("r"+t,JSON.stringify(e)),t--,cc.sys.localStorage.setItem("current",t),o.UI.updateUnRedo()}},redo:function(){var t=parseInt(cc.sys.localStorage.getItem("current"));if(t!=parseInt(cc.sys.localStorage.getItem("records"))){t++;var e=JSON.parse(cc.sys.localStorage.getItem("r"+t));switch(e[0]){case"ad":var n=o.Blocks.fromJSON(JSON.parse(e[1]));e[1]=n.bid,e[2]?"value"in n?I[e[2]].params[e[3]].argument=n:I[e[2]][e[3]]=n:n.parent=o.UI.layer,n.show();break;case"cp":(n=o.Blocks.fromBlock(I[e[1]],e[2])).parent=o.UI.layer,n.show();break;case"dl":var i=e[1]+0;e[1]=JSON.stringify(I[i].serialize(!0)),o.Blocks.remove(I[i])}cc.sys.localStorage.setItem("r"+t,JSON.stringify(e)),cc.sys.localStorage.setItem("current",t),o.UI.updateUnRedo()}}},o.Blocks={fromOnt:function(t){return null},fromBlock:function(t,e){return null},fromJSON:function(t){return null},add:function(t,e){e||(e=parseInt(cc.sys.localStorage.getItem("blocks"))+1,cc.sys.localStorage.setItem("blocks",e)),t.bid=e,I[t.bid]=t},remove:function(t){o.UI.focus==t&&(o.UI.focus=null),t.params.forEach(function(t){t.argument&&o.Blocks.remove(t.argument)});for(var e in t.bchilds)t[e]&&o.Blocks.remove(t[e]);t.parent=null,delete I[t.bid],t.node.destroy()},find:function(t,e){void 0===e&&(e=null);var n=o.Blocks.internal[t];return!n||e&&n.type!=e?null:n},internal:g};var v=((i={}).TRUE=!0,i.FALSE=!1,i),C=((r={})["+"]=function(t){return t[0]+t[1]},r["-"]=function(t){return t[0]-t[1]},r["\xd7"]=function(t){return t[0]*t[1]},r["\xf7"]=function(t){return t[0]/t[1]},r["%"]=function(t){return t[0]%t[1]},r.pow=function(t){return Math.pow(t[0],t[1])},r.abs=function(t){return Math.abs(t[0])},r.and=function(t){return t[0]&&t[1]},r.or=function(t){return t[0]||t[1]},r.not=function(t){return!t[0]},r[">"]=function(t){return t[0]>t[1]},r[">="]=function(t){return t[0]>=t[1]},r["<"]=function(t){return t[0]<t[1]},r["<="]=function(t){return t[0]<=t[1]},r),T=((a={}).start=function(){o.UI.clearLog(),o.UI.log("start run!")},a.let=function(t){t[0]=t[1]},a.print=function(t){o.UI.log(t[0])},a),S=function(){return function(t){this.statement=null,this.parent=t}}(),N=null;o.Runtime={errorOccurred:!1,Var:v,Exp:C,Sta:T,push:function(t){t&&(N=new S(N),o.Runtime.update(t))},pop:function(){if(!N)return o.UI.focus=null,null;var t=N;return N=N.parent,t},update:function(t){N.statement=t},next:function(){return o.UI.focus=null,!!N&&(N.statement?(o.UI.focus=N.statement,N.statement.execute(),!0):(o.Runtime.pop(),!!N&&o.Runtime.next()))}};var E,U=null;(function(t){t[t.Loading=0]="Loading",t[t.Editing=1]="Editing",t[t.Simulating=2]="Simulating"})(E||(E={})),o.UI={State:E,state:E.Loading,log:function(t){},clearLog:function(){},popup:function(t){},hidePopup:function(){},layer:null,get focus(){return U},set focus(t){t!=U&&(U&&(U.focused=!1,U.context.fillColor=o.Colors.Basic,U.node.zIndex=0,U.render()),t&&(t.focused=!0,t.context.fillColor=o.Colors.Focused,t.node.zIndex=1,t.render()),U=t,o.UI.state==o.UI.State.Editing&&(o.UI.showBlockEditor(t&&!("argument"in t)&&"start"!=t.data.name),o.UI.showSimulation(!t),o.UI.updateBlockSelector()))},fillFocus:function(t){for(var e in o.UI.focus.bchilds)if(!o.UI.focus[e]&&o.UI.focus[e+"Check"](t.data)){o.UI.focus[e]=t,"target"in t&&(t.target=e),o.UI.focus=null;break}},updateUnRedo:function(){},updateBlockSelector:function(){},showSimulation:function(t){},showBlockEditor:function(t){},showBlockSelector:function(t){}},o.Colors={Var:{String:cc.color(93,93,136),Number:cc.color(64,139,57),Boolean:cc.color(145,62,142)},Exp:{String:cc.color(137,162,189),Number:cc.color(136,196,36),Boolean:cc.color(207,101,139)},Para:{String:cc.color(137,162,189),Number:cc.color(136,196,36),Boolean:cc.color(207,101,139)},Sta:cc.color(241,202,75),LoopSta:cc.color(237,106,40),IfSta:cc.color(237,106,40),FinalSta:cc.color(201,104,97),StartSta:cc.color(201,104,97),Basic:cc.color(238,238,238),Focused:cc.color(255,94,87)},cc._RF.pop()},{}],ifStatement:[function(t,e,o){"use strict";cc._RF.push(e,"3222chTuZtNhYeMXS+jIeQO","ifStatement"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./statement"),i=t("../global"),r=t("./loopStatement"),a=cc._decorator,c=a.ccclass,s=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.otherCollider=null,e._other=null,e}var o;return __extends(e,t),o=e,Object.defineProperty(e.prototype,"other",{get:function(){return this._other},set:function(t){t==this._other||t&&this._other||(t&&(t.parent=this),this._other=t,this.isResetCalled&&(this.otherUpdate(),this.otherCollider.enabled="other"in this.bchilds&&!this.other,this.cascadeUpdate()))},enumerable:!0,configurable:!0}),e.prototype.otherUpdate=function(){var t=this.node.getContentSize();this.other?this.other.position=cc.v2(t.width,0):(this.otherCollider.size=cc.size(t.width-4,t.height-4),this.otherCollider.offset=cc.v2(t.width/2,-t.height/2))},e.prototype.otherCheck=function(t){return"else"==t.name||"else if"==t.name},e.prototype.bodyCheck=function(t){if("else"==t.name||"else if"==t.name)return!1;if("continue"==t.name||"break"==t.name){for(var e=this;e.parent;){if(e.parent.data.type==i.TypeType.LoopSta&&e.parent.body==e)return!0;e=e.parent}return!1}return!0},e.prototype.updateDisplay=function(){var t=this.node.getContentSize();if(this.body){var e=this.body.cascadeSize;this.size.height=t.height+e.height+r.default.CONNECTOR_HEIGHT}else this.size.height=t.height+30;var i=this.size.height,a=this.context;a.clear(),a.moveTo(0,-t.height),"if"==this.data.name?(a.lineTo(0,0),a.lineTo(o.CONNECTOR_WIDTH/2,-o.CONNECTOR_HEIGHT),a.lineTo(o.CONNECTOR_WIDTH,0)):(a.lineTo(0,-o.CONNECTOR_WIDTH),a.lineTo(o.CONNECTOR_HEIGHT,-o.CONNECTOR_WIDTH/2),a.lineTo(0,0)),"else"==this.data.name?(a.lineTo(t.width,0),a.lineTo(t.width,-t.height)):(a.lineTo(t.width,0),a.lineTo(t.width+o.CONNECTOR_HEIGHT,-o.CONNECTOR_WIDTH/2),a.lineTo(t.width,-o.CONNECTOR_WIDTH),a.lineTo(t.width,-t.height)),a.lineTo(3*o.CONNECTOR_WIDTH,-t.height),a.lineTo(2.5*o.CONNECTOR_WIDTH,-(t.height+o.CONNECTOR_HEIGHT)),a.lineTo(2*o.CONNECTOR_WIDTH,-t.height),"if"==this.data.name&&(a.lineTo(2*o.CONNECTOR_WIDTH,-i),a.lineTo(r.default.CONNECTOR_WIDTH,-i),a.lineTo(r.default.CONNECTOR_WIDTH/2,-(i+n.default.CONNECTOR_HEIGHT)),a.lineTo(0,-i)),a.close(),"if"==this.data.name?(this.collider.size=cc.size(o.CONNECTOR_WIDTH,o.CONNECTOR_HEIGHT),this.collider.offset=cc.v2(o.CONNECTOR_WIDTH/2,o.CONNECTOR_HEIGHT/2)):(this.collider.size=cc.size(o.CONNECTOR_HEIGHT,o.CONNECTOR_WIDTH),this.collider.offset=cc.v2(-o.CONNECTOR_HEIGHT/2,-o.CONNECTOR_WIDTH/2)),this.render()},Object.defineProperty(e.prototype,"cascadeSize",{get:function(){var t=this.node.getContentSize();if(this.next){var e=this.next.cascadeSize;t.width=Math.max(t.width,e.width),t.height+=e.height}if(this.body){var o=this.body.cascadeSize;t.width=Math.max(t.width,o.width+2*r.default.CONNECTOR_WIDTH),t.height+=o.height+r.default.CONNECTOR_HEIGHT}else t.height+=30;if(this.other){var n=this.other.cascadeSize;t.width+=n.width}return t},enumerable:!0,configurable:!0}),e.prototype.execute=function(){var t=!this.params[0]||this.params[0].value;i.Runtime.errorOccurred||("if"==this.data.name?(i.Runtime.update(this.next),t?i.Runtime.push(this.body):this.other&&i.Runtime.push(this.other)):t?i.Runtime.update(this.body):this.other&&i.Runtime.update(this.other))},e=o=__decorate([c],e)}(r.default));o.default=s,cc._RF.pop()},{"../global":"global","./loopStatement":"loopStatement","./statement":"statement"}],loopStatement:[function(t,e,o){"use strict";cc._RF.push(e,"19496vddIZDyZpjspiOev7h","loopStatement"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./statement"),i=t("../global"),r=cc._decorator,a=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bodyCollider=null,e._body=null,e}var o;return __extends(e,t),o=e,Object.defineProperty(e.prototype,"body",{get:function(){return this._body},set:function(t){t==this._body||t&&this._body||(t&&(t.parent=this),this._body=t,this.isResetCalled&&(this.bodyCollider.enabled="body"in this.bchilds&&!this.body,this.updateBlock(this)))},enumerable:!0,configurable:!0}),e.prototype.bodyUpdate=function(){var t=this.node.getContentSize();this.body?this.body.position=cc.v2(2*o.CONNECTOR_WIDTH,-t.height):(this.bodyCollider.size=cc.size(t.width-4,t.height-4),this.bodyCollider.offset=cc.v2(t.width/2,-t.height/2))},e.prototype.bodyCheck=function(t){return"else"!=t.name&&"else if"!=t.name},e.prototype.nextUpdate=function(){var t=this.size;this.next&&(this.next.position=cc.v2(0,-t.height));var e=t.height-this.node.getContentSize().height;this.nextCollider.size=cc.size(2*o.CONNECTOR_WIDTH,e-4),this.nextCollider.offset=cc.v2(o.CONNECTOR_WIDTH,-(t.height-e/2))},e.prototype.updateDisplay=function(){var t=this.node.getContentSize();if(this.body){var e=this.body.cascadeSize;this.size.height=t.height+e.height+o.CONNECTOR_HEIGHT}else this.size.height=t.height+30;var i=this.size.height,r=this.context;r.clear(),r.moveTo(0,-i),r.lineTo(0,0),r.lineTo(o.CONNECTOR_WIDTH/2,-o.CONNECTOR_HEIGHT),r.lineTo(o.CONNECTOR_WIDTH,0),r.lineTo(t.width,0),r.lineTo(t.width,-t.height),r.lineTo(3*o.CONNECTOR_WIDTH,-t.height),r.lineTo(2.5*o.CONNECTOR_WIDTH,-(t.height+o.CONNECTOR_HEIGHT)),r.lineTo(2*o.CONNECTOR_WIDTH,-t.height),r.lineTo(2*o.CONNECTOR_WIDTH,-i),r.lineTo(o.CONNECTOR_WIDTH,-i),r.lineTo(o.CONNECTOR_WIDTH/2,-(i+n.default.CONNECTOR_HEIGHT)),r.close(),this.render()},Object.defineProperty(e.prototype,"cascadeSize",{get:function(){var t=this.node.getContentSize();if(this.next){var e=this.next.cascadeSize;t.width=Math.max(t.width,e.width),t.height+=e.height}if(this.body){var n=this.body.cascadeSize;t.width=Math.max(t.width,n.width+2*o.CONNECTOR_WIDTH),t.height+=n.height+o.CONNECTOR_HEIGHT}else t.height+=30;return t},enumerable:!0,configurable:!0}),e.prototype.execute=function(){var t=this.params[0].value;i.Runtime.errorOccurred||(t?i.Runtime.push(this.body):i.Runtime.update(this.next))},e=o=__decorate([a],e)}(n.default));o.default=c,cc._RF.pop()},{"../global":"global","./statement":"statement"}],main:[function(t,e,o){"use strict";cc._RF.push(e,"93e3aVdx09Fxqpg8DvkAfAp","main"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./block/expression"),i=t("./block/statement"),r=t("./block/loopStatement"),a=t("./block/ifStatement"),c=t("./block/text"),s=t("./ui/blockSelector"),l=t("./block/param"),u=t("./global"),h=cc._decorator,p=h.ccclass,d=h.property;function f(t){var e=cc.instantiate(t.ccPrefab).getComponent(t);return e.init(),e}function m(t){var e=[];return t.forEach(function(t){if(t){var o=f(c.default);o.label=t,e.push(o)}else e.push(null)}),e}function b(t,e,o,n){var i=f(t);if(i.data=e,u.Blocks.add(i,n?n.bid:null),"input"in e)return i.texts=m([e.input]),i;if(!("params"in e))return i.texts=m([e.name]),i;if(i.texts=m(e.texts),i.params=function(t,e,o){var n=[];return t.forEach(function(t,i){var r=f(l.default);r.label=t.name,r.color=u.Colors.Para[t.proto],r.pid=i,r.data=t,e&&e[i].argument&&(r.argument=u.Blocks.fromBlock(e[i].argument)),o&&o[i]&&(r.argument=u.Blocks.fromJSON(o[i])),n.push(r)}),n}(e.params,o?o.params:null,n?n.args:null),o)for(var r in o.bchilds)i[r]=u.Blocks.fromBlock(o[r]),i[r]&&(i[r].target=r);if(n)for(var a in n)n[a].name&&(i[a]=u.Blocks.fromJSON(n[a]),i[a]&&(i[a].target=a));return i}var _={Temp:n.default,Var:n.default,Exp:n.default,Sta:i.default,LoopSta:r.default,IfSta:a.default,FinalSta:i.default};function y(t){var e=f(s.default);return e.label=t.name,e.data=t,e}u.Blocks.fromBlock=function(t,e){return t?b(_[t.data.type],t.data,t,e?{bid:e}:null):null},u.Blocks.fromOnt=function(t){return t?b(_[t.type],t):null},u.Blocks.fromJSON=function(t){if(!t)return null;var e="Temp"==t.name?new u.Temp(t.input,t.proto):u.Blocks.find(t.name);return b(_[e.type],e,null,t)};var g=[],I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.startStatement=null,e.textPrefab=null,e.paramPrefab=null,e.expressionPrefab=null,e.statementPrefab=null,e.loopStatementPrefab=null,e.elifStatementPrefab=null,e.blockSelectorPrefab=null,e.blocksContent=null,e.blockSelector=null,e}return __extends(e,t),e.prototype.start=function(){var t=this;cc.systemEvent.on(cc.game.EVENT_HIDE,cc.director.pause),cc.systemEvent.on(cc.game.EVENT_SHOW,cc.director.resume),cc.game.setFrameRate(20),l.default.ccPrefab=this.paramPrefab,c.default.ccPrefab=this.textPrefab,n.default.ccPrefab=this.expressionPrefab,i.default.ccPrefab=this.statementPrefab,r.default.ccPrefab=this.loopStatementPrefab,a.default.ccPrefab=this.elifStatementPrefab,s.default.ccPrefab=this.blockSelectorPrefab,this.startStatement.texts=m(["START"]),this.startStatement.data=new u.StartSta,this.startStatement.init(),this.startStatement.show(),u.Blocks.add(this.startStatement,1),u.UI.updateBlockSelector=function(){if(t.blockSelector.active)if(u.UI.focus)if(u.UI.focus.bchilds){var e=[],o="argument"in u.UI.focus;for(var n in u.UI.focus.bchilds)u.UI.focus[n]||e.push(n);g.forEach(function(t){if(o=="proto"in t.data){for(var n in e)if(u.UI.focus[e[n]+"Check"](t.data))return void(t.node.active=!0);t.node.active=!1}else t.node.active=!1})}else g.forEach(function(t){t.node.active=!1});else g.forEach(function(t){t.node.active=!0})},u.UI.showBlockSelector=function(e){t.blockSelector.active=e};var e=y(new u.Exp("Number",u.ProtoType.Number,[]));e.onClick=this.createTempNumber.bind(this),this.blocksContent.node.addChild(e.node),g.push(e),e.show(),(e=y(new u.Exp("String",u.ProtoType.String,[]))).onClick=this.createTempString.bind(this),this.blocksContent.node.addChild(e.node),g.push(e),e.show();for(var o in u.Blocks.internal){var h=y(u.Blocks.internal[o]);this.blocksContent.node.addChild(h.node),g.push(h),h.show()}this.scheduleOnce(this._load.bind(this)),this.schedule(this._save.bind(this),10),cc.director.getCollisionManager().enabled=!0},e.prototype._load=function(){cc.sys.localStorage.getItem("blocks")||(cc.sys.localStorage.setItem("blocks",1),cc.sys.localStorage.setItem("records",0),cc.sys.localStorage.setItem("current",0)),u.UI.state=u.UI.State.Editing,u.UI.updateUnRedo();var t=cc.sys.localStorage.getItem("start");if(t){var e=u.Blocks.fromJSON(JSON.parse(t));this.startStatement.next=e,e.show()}},e.prototype._save=function(){this.startStatement.next&&(cc.sys.localStorage.setItem("start",JSON.stringify(this.startStatement.next.serialize(!0))),console.log("saved"))},e.prototype.createTempNumber=function(){u.UI.popup({title:"The value of Number block",useInput:!0,onConfirm:function(t){var e=u.Blocks.fromOnt(new u.Temp(t,u.ProtoType.Number)),o=["ad",e.bid];u.UI.focus?(u.UI.fillFocus(e),o.push(e.parent.parent.bid),o.push(e.parent.pid)):e.parent=u.UI.layer,u.Records.push(o),e.show(),u.UI.hidePopup()},inputDefault:"100",inputMaxLen:8,inputMode:cc.EditBox.InputMode.NUMERIC})},e.prototype.createTempString=function(){u.UI.popup({title:"The value of String block",useInput:!0,onConfirm:function(t){var e=u.Blocks.fromOnt(new u.Temp('"'+t+'"',u.ProtoType.String)),o=["ad",e.bid];u.UI.focus?(u.UI.fillFocus(e),o.push(e.parent.parent.bid),o.push(e.parent.pid)):e.parent=u.UI.layer,u.Records.push(o),e.show(),u.UI.hidePopup()},inputDefault:"hello",inputMaxLen:20,inputMode:cc.EditBox.InputMode.SINGLE_LINE})},__decorate([d(i.default)],e.prototype,"startStatement",void 0),__decorate([d(cc.Prefab)],e.prototype,"textPrefab",void 0),__decorate([d(cc.Prefab)],e.prototype,"paramPrefab",void 0),__decorate([d(cc.Prefab)],e.prototype,"expressionPrefab",void 0),__decorate([d(cc.Prefab)],e.prototype,"statementPrefab",void 0),__decorate([d(cc.Prefab)],e.prototype,"loopStatementPrefab",void 0),__decorate([d(cc.Prefab)],e.prototype,"elifStatementPrefab",void 0),__decorate([d(cc.Prefab)],e.prototype,"blockSelectorPrefab",void 0),__decorate([d(cc.Layout)],e.prototype,"blocksContent",void 0),__decorate([d(cc.Node)],e.prototype,"blockSelector",void 0),e=__decorate([p],e)}(cc.Component);o.default=I,cc._RF.pop()},{"./block/expression":"expression","./block/ifStatement":"ifStatement","./block/loopStatement":"loopStatement","./block/param":"param","./block/statement":"statement","./block/text":"text","./global":"global","./ui/blockSelector":"blockSelector"}],manager:[function(t,e,o){"use strict";cc._RF.push(e,"c1015DLtF9ImL1EM60eOxIf","manager"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=t("../global"),r=t("../block/statement"),a=t("../block/block"),c=cc._decorator,s=c.ccclass,l=c.property;(function(t){t[t.IDLE=0]="IDLE",t[t.START=1]="START",t[t.DRAGGING=2]="DRAGGING",t[t.CANCELLED=3]="CANCELLED"})(n||(n={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.statement=null,e.layer=null,e.UIBlockEditor=null,e.UIRedo=null,e.UIUndo=null,e.UISimulation=null,e.UILog=null,e.UIPopup=null,e.UIPopupTitle=null,e.UIPopupInput=null,e.UIEnd=null,e.UIRun=null,e.UIPause=null,e.UIStep=null,e.UIRestart=null,e.BlocksBlocker=null,e.draggable=!1,e._state=n.IDLE,e._origin=null,e._xMax=0,e._xMin=0,e._yMax=0,e._yMin=0,e}return __extends(e,t),e.prototype.onTouchStart=function(t){t.stopPropagation(),this._state=n.START;var e=this.statement.cascadeSize,o=cc.view.getVisibleSize().height;this._origin=this.statement.position,this._yMin=o/2-80-this._origin.y,this._yMax=Math.max(e.height-o/2+120-this._origin.y,this._yMin),this._xMin=-(e.width-250)-this._origin.x,this._xMax=-300-this._origin.x},e.prototype.onTouchMove=function(t){t.stopPropagation();var e=t.getLocation().sub(t.getStartLocation());switch(this._state){case n.DRAGGING:break;case n.START:if(e.mag()<10)return;if(!this.draggable)return void(this._state=n.CANCELLED);this._state=n.DRAGGING;break;case n.IDLE:if(!this.draggable)return void(this._state=n.CANCELLED);this._state=n.DRAGGING;break;case n.CANCELLED:return}e.x=Math.min(this._xMax,Math.max(this._xMin,e.x)),e.y=Math.min(this._yMax,Math.max(this._yMin,e.y)),e.x=40*Math.round(e.x/40),e.y=40*Math.round(e.y/40),this.statement.position=this._origin.add(e)},e.prototype.onTouchEnd=function(t){switch(t.stopPropagation(),this._state){case n.DRAGGING:break;case n.START:i.UI.focus=null}this._state=n.IDLE},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},e.prototype.start=function(){var t=this;this.UIPopup.active=!1,i.UI.layer=this.layer,i.UI.log=function(e){t.UILog.string+=String(e)+"\n"},i.UI.clearLog=function(){t.UILog.string=""},i.UI.updateUnRedo=function(){t.UIUndo.node.active=0!=cc.sys.localStorage.getItem("current"),t.UIRedo.node.active=cc.sys.localStorage.getItem("current")<cc.sys.localStorage.getItem("records")},i.UI.showBlockEditor=function(e){t.UIBlockEditor.active=e},i.UI.showSimulation=function(e){t.UISimulation.active=e},i.UI.popup=function(e){e.title?(t.UIPopupTitle.string=e.title,t.UIPopupTitle.node.active=!0):t.UIPopupTitle.node.active=!1,e.useInput?(t.UIPopupInput.node.active=!0,t.UIPopupInput.string=e.inputDefault?e.inputDefault:"",t.UIPopupInput.inputMode=e.inputMode?e.inputMode:cc.EditBox.InputMode.SINGLE_LINE,t.UIPopupInput.maxLength=e.inputMaxLen?e.inputMaxLen:8):t.UIPopupInput.node.active=!1,t.cancelClick=e.onCancel?e.onCancel:function(){t.UIPopup.active=!1},t.confirmClick=function(){e.onConfirm?e.onConfirm(t.UIPopupInput.string):t.UIPopup.active=!1},t.UIPopup.active=!0},i.UI.hidePopup=function(){t.UIPopup.active=!1}},e.prototype.cancelClick=function(){},e.prototype.confirmClick=function(t){},e.prototype.simulationClick=function(){this.UIEnd.active=!0,i.UI.showSimulation(!1),i.UI.showBlockSelector(!1),this.BlocksBlocker.active=!0,this.layer.node.active=!1,this.UIStep.node.active=!0,this.UIRestart.node.active=!0,this.restartClick(),i.UI.state=i.UI.State.Simulating},e.prototype.endClick=function(){for(this.unschedule(this._autoSimulation);i.Runtime.pop(););i.UI.clearLog(),i.UI.showSimulation(!0),i.UI.showBlockSelector(!0),this.layer.node.active=!0,this.UIRun.node.active=!1,this.UIStep.node.active=!1,this.UIPause.node.active=!1,this.UIRestart.node.active=!1,this.UIEnd.active=!1,this.BlocksBlocker.active=!1,i.UI.state=i.UI.State.Editing},e.prototype._autoSimulation=function(){var t=i.Runtime.next();if(i.Runtime.errorOccurred||!t)return this.unschedule(this._autoSimulation),this.UIRun.node.active=!0,this.UIPause.node.active=!1,this.UIRun.interactable=!1,this.UIStep.interactable=!1,void(this.UIRestart.interactable=!0)},e.prototype.runClick=function(){this.UIRun.node.active=!1,this.UIPause.node.active=!0,this.UIPause.interactable=!0,this.UIStep.interactable=!1,this.UIRestart.interactable=!0,this.schedule(this._autoSimulation,1)},e.prototype.pauseClick=function(){this.unschedule(this._autoSimulation),this.UIRun.node.active=!0,this.UIPause.node.active=!1,this.UIRun.interactable=!0,this.UIStep.interactable=!0},e.prototype.stepClick=function(){var t=i.Runtime.next();i.Runtime.errorOccurred?(this.UIRun.interactable=!1,this.UIStep.interactable=!1):t?this.UIRun.interactable=!0:(this.UIRun.interactable=!1,this.UIStep.interactable=!1),this.UIPause.node.active=!1,this.UIRestart.interactable=!0},e.prototype.restartClick=function(){for(this.unschedule(this._autoSimulation),this.UIRun.node.active=!0,this.UIPause.node.active=!1,this.UIRun.interactable=!0,this.UIStep.interactable=!0,this.UIRestart.interactable=!1,i.UI.clearLog(),i.Runtime.errorOccurred=!1;i.Runtime.pop(););i.Runtime.push(this.statement)},e.prototype.deleteClick=function(){i.UI.focus&&"params"in i.UI.focus&&i.UI.popup({title:'Are you sure you want to delete the blcok "'+i.UI.focus.data.name+'" and its children?',onConfirm:function(){if("params"in i.UI.focus){var t=i.UI.focus,e=["dl",JSON.stringify(t.serialize(!0))];"layer"==t.parent.data.name||("value"in t?(e.push(t.parent.parent.bid),e.push(t.parent.pid)):(e.push(t.parent.bid),e.push(t.target))),i.Records.push(e),i.Blocks.remove(t),i.UI.hidePopup()}}})},e.prototype.copyClick=function(){if(i.UI.focus&&"params"in i.UI.focus){var t=i.Blocks.fromBlock(i.UI.focus);i.Records.push(["cp",i.UI.focus.bid,t.bid]),t.parent=i.UI.layer,t.show()}},e.prototype.commentClick=function(){i.UI.focus&&"params"in i.UI.focus&&console.log(JSON.stringify(i.UI.focus.serialize(!1)))},e.prototype.redoClick=function(){i.Records.redo()},e.prototype.undoClick=function(){i.Records.undo()},e.prototype.startClick=function(){this.statement.next||(i.UI.focus=this.statement)},__decorate([l(r.default)],e.prototype,"statement",void 0),__decorate([l(a.default)],e.prototype,"layer",void 0),__decorate([l(cc.Node)],e.prototype,"UIBlockEditor",void 0),__decorate([l(cc.Button)],e.prototype,"UIRedo",void 0),__decorate([l(cc.Button)],e.prototype,"UIUndo",void 0),__decorate([l(cc.Node)],e.prototype,"UISimulation",void 0),__decorate([l(cc.Label)],e.prototype,"UILog",void 0),__decorate([l(cc.Node)],e.prototype,"UIPopup",void 0),__decorate([l(cc.Label)],e.prototype,"UIPopupTitle",void 0),__decorate([l(cc.EditBox)],e.prototype,"UIPopupInput",void 0),__decorate([l(cc.Node)],e.prototype,"UIEnd",void 0),__decorate([l(cc.Button)],e.prototype,"UIRun",void 0),__decorate([l(cc.Button)],e.prototype,"UIPause",void 0),__decorate([l(cc.Button)],e.prototype,"UIStep",void 0),__decorate([l(cc.Button)],e.prototype,"UIRestart",void 0),__decorate([l(cc.Node)],e.prototype,"BlocksBlocker",void 0),__decorate([l(cc.Boolean)],e.prototype,"draggable",void 0),e=__decorate([s],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../block/block":"block","../block/statement":"statement","../global":"global"}],param:[function(t,e,o){"use strict";cc._RF.push(e,"af8aepq5SZCCoMPdIhq9haI","param"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../util/collider"),i=t("./text"),r=t("../global"),a=cc._decorator,c=a.ccclass,s=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.context=null,e.argumentCollider=null,e.bchilds={argument:!0},e._argument=null,e}var o;return __extends(e,t),o=e,Object.defineProperty(e.prototype,"argument",{get:function(){return this._argument},set:function(t){t==this._argument||t&&this._argument||(this._isOnLoadCalled&&(this.ccLabel.enabled=!t),t&&(t.parent=this),this._argument=t,this.isResetCalled&&(this.argumentCollider.enabled=!t,this.updateBlock(this)))},enumerable:!0,configurable:!0}),e.prototype.argumentUpdate=function(){if(this.argument)this.argument.position=cc.v2(0,0);else{var t=this.size;this.argumentCollider.size=t,this.argumentCollider.offset=cc.v2(t.width/2,-t.height/2)}},e.prototype.argumentCheck=function(t){return this.render(),(!this.data.edit||t.type==r.TypeType.Var&&!t.readonly)&&t.proto==this.data.proto},e.prototype.updateDisplay=function(){this.context.clear(),this.argument?this.size=this.argument.size:(this.context.roundRect(0,-this.size.height,this.size.width,this.size.height,o.PADDING),this.render())},e.prototype.render=function(){this.context.fill(),this.context.stroke()},e.prototype.updateContent=function(){var t=this.ccLabel.node.getContentSize(),e=Math.max(t.width/2+2*o.PADDING,o.MIN_WIDTH),n=t.height/2+2*o.PADDING;this.node.setContentSize(e,n),this.ccLabel.node.position=cc.v2((e-t.width/2)/2,-o.PADDING),this.size=this.argument?this.argument.size:this.node.getContentSize()},e.prototype.onClick=function(){r.UI.focus?this.parent.onClick():r.UI.focus=this},Object.defineProperty(e.prototype,"value",{get:function(){return this.argument?this.argument.value:(r.Runtime.errorOccurred=!0,r.UI.popup({title:'Error!\nNo assignment for parameter "'+this.data.name+'".'}),null)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.argument&&(this.ccLabel.enabled=!1,this.argument.reset()),this.context.strokeColor=this.color,this.context.fillColor=r.Colors.Basic,this.isResetCalled=!0,this.updateBlock(null),this.node.opacity=255},e.PADDING=6,e.MIN_WIDTH=40,__decorate([s(cc.Graphics)],e.prototype,"context",void 0),__decorate([s(n.default)],e.prototype,"argumentCollider",void 0),e=o=__decorate([c],e)}(i.default);o.default=l,cc._RF.pop()},{"../global":"global","../util/collider":"collider","./text":"text"}],statement:[function(t,e,o){"use strict";cc._RF.push(e,"e215cqx5OdEuLHmggK7iXwJ","statement"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./block"),i=t("../util/collider"),r=t("../global"),a=cc._decorator,c=a.ccclass,s=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.context=null,e.collider=null,e.nextCollider=null,e._next=null,e._params=[],e._texts=[],e.target=null,e._focused=!1,e}var o;return __extends(e,t),o=e,Object.defineProperty(e.prototype,"next",{get:function(){return this._next},set:function(t){t==this._next||t&&this._next||(t&&(t.parent=this),this._next=t,this.isResetCalled&&(this.nextUpdate(),this.nextCollider.enabled="next"in this.bchilds&&!this.next,this.cascadeUpdate()))},enumerable:!0,configurable:!0}),e.prototype.nextUpdate=function(){var t=this.size;this.next?this.next.position=cc.v2(0,-t.height):(this.nextCollider.size=cc.size(t.width-4,t.height-4),this.nextCollider.offset=cc.v2(t.width/2,-t.height/2))},e.prototype.nextCheck=function(t){if("else"==t.name||"else if"==t.name)return!1;if("continue"==t.name||"break"==t.name){for(var e=this;e.parent&&"bid"in e.parent;){if(e.parent.data.type==r.TypeType.LoopSta&&e.parent.next!=e)return!0;e=e.parent}return!1}return!0},Object.defineProperty(e.prototype,"params",{get:function(){return this._params},set:function(t){this._params&&this._params.forEach(function(t){t.parent=null},this),this._params=t,t.forEach(function(t){t.parent=this},this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texts",{get:function(){return this._texts},set:function(t){this._texts&&this._texts.forEach(function(t){t&&(t.parent=null)},this),this._texts=t,t.forEach(function(t){t&&(t.parent=this)},this)},enumerable:!0,configurable:!0}),e.prototype.updateContent=function(){var t=this,e=[];this.texts[0]&&e.push(this.texts[0]),this.params.forEach(function(o,n){e.push(o),t.texts[n+1]&&e.push(t.texts[n+1])});var n=cc.size(0,0);e.forEach(function(t){n.width+=t.size.width,n.height=Math.max(t.size.height,n.height)}),n.width+=o.SPACING*(e.length-1);var i=cc.size(n);i.width=Math.max(i.width+o.PADDING+2,o.MINWIDTH),i.height=Math.max(i.height+o.PADDING+2,o.MINHEIGHT);var r=(i.width-n.width)/2;e.forEach(function(t){t.position=cc.v2(r,-(i.height-t.size.height)/2),r+=t.size.width+o.SPACING}),this.node.setContentSize(i),this.size=cc.size(i)},Object.defineProperty(e.prototype,"cascadeSize",{get:function(){var t=this.node.getContentSize();if(this.next){var e=this.next.cascadeSize;t.width=Math.max(t.width,e.width),t.height+=e.height}return t},enumerable:!0,configurable:!0}),e.prototype.render=function(){this.context.fill(),this.context.stroke()},e.prototype.updateDisplay=function(){var t=this.size,e=this.context;e.clear(),e.moveTo(0,-t.height),e.lineTo(0,0),"start"!=this.data.name&&(e.lineTo(o.CONNECTOR_WIDTH/2,-o.CONNECTOR_HEIGHT),e.lineTo(o.CONNECTOR_WIDTH,0)),e.lineTo(t.width,0),e.lineTo(t.width,-t.height),this.data.type!=r.TypeType.FinalSta&&(e.lineTo(o.CONNECTOR_WIDTH,-t.height),e.lineTo(o.CONNECTOR_WIDTH/2,-(t.height+o.CONNECTOR_HEIGHT))),e.close(),this.collider.size=cc.size(o.CONNECTOR_WIDTH,o.CONNECTOR_HEIGHT),this.collider.offset=cc.v2(o.CONNECTOR_WIDTH/2,o.CONNECTOR_HEIGHT/2),this.render()},e.prototype.onDragStart=function(t){this.node.opacity=125,this.target=null,this.parent=r.UI.layer,r.UI.focus=null,r.UI.showBlockSelector(!1),this.collider.enabled=!0},e.prototype.onDragEnd=function(t){this.node.opacity=255,this.target&&(r.UI.focus[this.target]=this),r.UI.showBlockSelector(!0),this.collider.enabled=!1},e.prototype.onClick=function(t){if(r.UI.focus){if(!("next"in r.UI.focus)||r.UI.focus==this||r.UI.focus.node.isChildOf(this.node))return;r.UI.fillFocus(this)}else r.UI.focus=this},Object.defineProperty(e.prototype,"focused",{get:function(){return this._focused},set:function(t){this._focused!=t&&(this._focused=t,t?(this.context.fillColor=r.Colors.Focused,this.node.zIndex=1):(this.context.fillColor=r.Colors.Basic,this.node.zIndex=0),this.render())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(t){if(this.parent!=t){var e=null;if(this._parent&&"bid"in this.parent){e=this._parent.node.convertToWorldSpaceAR(this.position);for(var o in this._parent.bchilds)if(this._parent[o]==this){this._parent[o]=null;break}}this._parent=t,this.node.parent=t?t.node:null,this.node.zIndex=0,"bid"in t||(this.position=e?t.node.convertToNodeSpaceAR(e):cc.v2())}},enumerable:!0,configurable:!0}),e.prototype.serialize=function(t){var e={bid:this.bid,name:this.data.name,args:[]};this.params.forEach(function(o){e.args.push(o.argument?t?o.argument.serialize(!0):o.argument.bid:null)});for(var o in this.bchilds)this[o]&&(e[o]=t?this[o].serialize(!0):this[o].bid);return e},e.prototype.execute=function(){var t=[];if(this.params.forEach(function(e){t.push(e.value)}),!r.Runtime.errorOccurred)switch(this.data.name){case"break":for(var e=r.Runtime.pop().statement;!e||e.data.type!=r.TypeType.LoopSta;)e=r.Runtime.pop().statement;r.Runtime.push(e.next);break;case"continue":for(e=r.Runtime.pop().statement;e.data.type!=r.TypeType.LoopSta;)e=r.Runtime.pop().statement;r.Runtime.push(e);break;case"end":for(;r.Runtime.pop(););break;default:r.Runtime.Sta[this.data.name](t),r.Runtime.update(this.next)}},e.prototype.reset=function(){switch(this.params.forEach(function(t){t.reset()}),this.texts.forEach(function(t){t&&t.reset()}),this.context.fillColor=r.Colors.Basic,this.color=r.Colors[this.data.type],this.context.strokeColor=this.color,this.data.type){case r.TypeType.Sta:case r.TypeType.StartSta:this.bchilds={next:!0};break;case r.TypeType.FinalSta:this.bchilds={};break;case r.TypeType.LoopSta:this.bchilds={next:!0,body:!0};break;case r.TypeType.IfSta:this.bchilds={},"if"==this.data.name?(this.bchilds.next=!0,this.bchilds.other=!0):"else if"==this.data.name&&(this.bchilds.other=!0),this.bchilds.body=!0}for(var t in this.bchilds)this[t]?(this[t+"Collider"].enabled=!1,this[t].reset()):this[t+"Collider"].enabled=!0;this.isResetCalled=!0,this.updateBlock(null),this.node.opacity=255},e.prototype.init=function(){var t=this;this.isResetCalled=!1,this.getComponents(i.default).forEach(function(e){t[e.child+"Collider"]=e,e.enabled=!1}),this.node.opacity=0},e.CONNECTOR_WIDTH=20,e.CONNECTOR_HEIGHT=10,e.PADDING=10,e.SPACING=10,e.MINWIDTH=80,e.MINHEIGHT=50,__decorate([s(cc.Graphics)],e.prototype,"context",void 0),__decorate([s(i.default)],e.prototype,"collider",void 0),e=o=__decorate([c],e)}(n.default);o.default=l,cc._RF.pop()},{"../global":"global","../util/collider":"collider","./block":"block"}],text:[function(t,e,o){"use strict";cc._RF.push(e,"e1f07D+QyhOJJSOchtOw7sV","text"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./block"),i=cc._decorator,r=i.ccclass,a=i.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=cc.Color.BLACK,e.ccLabel=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return this._label},set:function(t){this._label!=t&&(this.ccLabel.string=t,this._label=t,this.updateBlock(this))},enumerable:!0,configurable:!0}),e.prototype.updateContent=function(){var t=this.node.getContentSize();this.size=cc.size(t.width/2,t.height/2)},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(t){this.parent!=t&&(this._parent=t,this.node.parent=t?t.node:null,this.node.zIndex=0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.isResetCalled=!0,this.node.color=this.color,this.updateContent(),this.node.opacity=255},__decorate([a(cc.Label)],e.prototype,"ccLabel",void 0),e=__decorate([r],e)}(n.default);o.default=c,cc._RF.pop()},{"./block":"block"}],touch:[function(t,e,o){"use strict";cc._RF.push(e,"4a409ykpIVH64WqVnrZyQxp","touch"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=cc._decorator,r=i.ccclass,a=i.property;(function(t){t[t.IDLE=0]="IDLE",t[t.START=1]="START",t[t.DRAGGING=2]="DRAGGING",t[t.CANCELLED=3]="CANCELLED"})(n||(n={}));var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.clickEvent=null,e.dragStartEvent=null,e.dragEndEvent=null,e.draggable=!1,e.position=cc.v2(),e._state=n.IDLE,e}return __extends(e,t),e.prototype.onTouchStart=function(t){t.stopPropagation(),this.position=t.getLocation(),this._state=n.START},e.prototype.onTouchMove=function(t){var e;switch(this._state){case n.DRAGGING:t.stopPropagation(),this.position=t.getLocation(),e=t.getDelta();break;case n.START:if((e=t.getLocation().sub(t.getStartLocation())).mag()<8)return void t.stopPropagation();if(!this.draggable)return void(this._state=n.CANCELLED);t.stopPropagation(),this._state=n.DRAGGING,this.position=t.getStartLocation(),this.dragStartEvent&&this.dragStartEvent.emit([this]),this.position=t.getLocation();break;case n.IDLE:if(!this.draggable)return void(this._state=n.CANCELLED);t.stopPropagation(),e=t.getLocation().sub(t.getStartLocation()),this._state=n.DRAGGING,this.position=t.getStartLocation(),this.dragStartEvent&&this.dragStartEvent.emit([this]),this.position=t.getLocation();break;case n.CANCELLED:return}this.node.position=this.node.position.add(e)},e.prototype.onTouchEnd=function(t){switch(this._state){case n.DRAGGING:t.stopPropagation(),this.dragEndEvent&&this.dragEndEvent.emit([this]);break;case n.START:t.stopPropagation(),this.clickEvent&&this.clickEvent.emit([this])}this._state=n.IDLE},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},__decorate([a(cc.Component.EventHandler)],e.prototype,"clickEvent",void 0),__decorate([a(cc.Component.EventHandler)],e.prototype,"dragStartEvent",void 0),__decorate([a(cc.Component.EventHandler)],e.prototype,"dragEndEvent",void 0),__decorate([a(cc.Boolean)],e.prototype,"draggable",void 0),e=__decorate([r],e)}(cc.Component);o.default=c,cc._RF.pop()},{}]},{},["block","expression","ifStatement","loopStatement","param","statement","text","global","main","blockSelector","manager","collider","touch"]);